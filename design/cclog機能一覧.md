# cclog 機能一覧

## プロジェクト概要

cclog は、Claude Code の会話履歴をコマンドライン上で閲覧・管理するためのツールです。fzf を使用したインタラクティブなブラウザーを提供し、過去のセッションの検索、閲覧、再開を効率的に行えます。

## 主要機能

### 1. セッション一覧表示 (`cclog`)

- 現在のディレクトリに関連する Claude Code セッションを一覧表示
- セッション情報の表示（作成日時、変更日時、継続時間、メッセージ数）
- fzf によるインタラクティブな検索・絞り込み
- リアルタイムプレビュー機能

**キーバインド:**

- `Enter`: セッション ID を返す
- `Ctrl-V`: ログをページャーで表示
- `Ctrl-P`: ファイルパスを返す
- `Ctrl-R`: `claude -r`でセッションを再開

### 2. プロジェクト一覧表示 (`cclog projects`)

- 全ての Claude Code プロジェクトを最新活動順で表示
- プロジェクトパスとセッション数の表示
- プレビューでプロジェクトの最新セッションを表示

**キーバインド:**

- `Enter`: 選択したプロジェクトのディレクトリに移動

### 3. セッション表示 (`cclog view <session-file>`)

- 指定されたセッションファイルの内容を色分けして表示
- メッセージタイプ別の色分け（ユーザー: シアン、アシスタント: 白、ツール: グレー）
- タイムスタンプ付きメッセージ表示

### 4. セッション情報表示 (`cclog info <session-file>`)

- セッションの詳細情報を表示
- セッション ID、メッセージ数、開始・終了時刻、継続時間
- トピック要約の表示（利用可能な場合）

## 技術的特徴

### パフォーマンス最適化

- **Python ヘルパースクリプト**: 大量の会話履歴に対する高速処理
- **ストリーミング処理**: メモリ効率的なファイル読み込み
- **段階的解析**: 必要最小限の情報のみを段階的に取得
- **キャッシュ機能**: パス解析結果のキャッシュによる高速化

### インテリジェント機能

- **プロジェクトパスデコード**: Claude Code の内部エンコーディングを解析してプロジェクトパスを復元
- **要約表示**: セッション要約が利用可能な場合は 📑 アイコン付きで表示
- **相対時間表示**: "6m ago", "2h ago"形式での直感的な時間表示
- **ターミナル幅対応**: 端末幅に応じた表示内容の自動調整

### クロスシェル対応

- **bash/zsh 対応**: 両方のシェルで動作
- **プラグインマネージャー対応**: Sheldon、Oh-My-Zsh、Zinit、Zplug、Antigen、Zgen、Antibody をサポート
- **自動検出**: Python 3 の自動検出と適切なパス解決

## ファイル構成

### メインファイル

- `cclog.sh`: メインのシェルスクリプト（bash/zsh 対応）
- `cclog_helper.py`: パフォーマンス最適化された Python ヘルパー
- `cclog.plugin.zsh`: Zsh プラグインマネージャー用ラッパー

### テスト・ドキュメント

- `tests/`: テストスイート
  - `test_cclog_helper.py`: Python ヘルパーのテスト
  - `test_decode_project_path.py`: パスデコード機能のテスト
  - `fixtures/`: テスト用 JSONL ファイル
- `run_tests.sh`: テスト実行スクリプト
- `README.md`: インストール・使用方法
- `CHANGELOG.md`: 変更履歴
- `LICENSE`: MIT ライセンス

## 依存関係

- `fzf`: ファジーファインダー（必須）
- `python3`: Python 3.x（必須）
- `claude`: Claude Code CLI（再開機能に必要）

## 設計の特徴

### モジュラー設計

- シェルスクリプトと Python の適切な役割分担
- 内部関数の適切なスコープ管理（`__cclog_*`プレフィックス）
- 段階的フォールバック機能

### ユーザビリティ

- 直感的なキーバインド
- リアルタイムプレビュー
- エラーハンドリングとユーザーフレンドリーなメッセージ
- ヘルプ機能の充実

### 拡張性

- プラグインシステム対応
- 設定可能な環境変数
- テスタブルな設計

この設計により、Claude Code ユーザーが効率的に過去の会話履歴を管理・活用できる強力なツールとなっています。
